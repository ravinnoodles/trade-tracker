<!DOCTYPE html>
<html>
    <head>
        <title>Trade Tracker</title>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"> </script>
        <script type="text/javascript" src="js/papaparse.min.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <div class="col-lg-8 mx-auto p-4 py-md-5">
            <header>
                <h3>Trade Tracker</h3>
            </header>
            <section id="loading">
                <div class="col-lg-6 mx-auto p-3 py-md-3">
                    loading...
                </div>
            </section>
            <section id="tracker">
                <section class="my-2">
                    <div class="btn-group" id="trainers">
    
                    </div>
                </section>
                <section id="list">
    
                </section>
            </section>
        </div>
        
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase.js"></script>
        <script type="text/javascript">
            var regions = null;
            var pokemon = null;
            var noTradeAllowed = null;
            var lists = null;

            function init() {
                $("#tracker").hide();

                // Your web app's Firebase configuration
                const firebaseConfig = {
                apiKey: "AIzaSyC0rBKRIOO0zvM04DRqz7zE_KYEGKsVZsQ",
                authDomain: "trade-tracker-c1fa6.firebaseapp.com",
                databaseURL: "https://trade-tracker-c1fa6-default-rtdb.firebaseio.com",
                projectId: "trade-tracker-c1fa6",
                storageBucket: "trade-tracker-c1fa6.appspot.com",
                messagingSenderId: "77322068134",
                appId: "1:77322068134:web:da77e03ab5550c78761467"
                };
            
                // Initialize Firebase
                firebase.initializeApp(firebaseConfig);

                firebase.auth().onAuthStateChanged((user) => {
                    console.log(user);

                    firebase.database().ref('/').on("value", function(data) {
                        regions = data.val().regions;
                        pokemon = data.val().pokemon;
                        noTradeAllowed = data.val().noTradeAllowed;
                        lists = data.val().lists;

                        lists.forEach((row, i) => {
                            var btn = $(`<a href="#" class="btn btn-primary trainerButton" data="${i}">${row.Trainer}</a>`)
                            $("#trainers").append(btn);
                        });

                        showInfo();
                    })

                    

                    

                    
                });


            }

            window.addEventListener('DOMContentLoaded', init)

            function showInfo() {             

                $("#loading").fadeOut(400, function (){
                    $("#tracker").show();
                });

                $(".trainerButton").on("click", function() {
                    var index = $(this).attr("data");

                    if (data[index]) {
                        $("#list").empty();
                        var needed = data[index].Needed.replaceAll('"','').split(',');
                        db.regions.forEach((region) => {
                            var result = needed.filter((x) => x >= region.range.min && x <= region.range.max );

                            var header = $(`<div class="card-header">${region.name}<div>`);
                            var body = $(`<div class="card-body"></div>`);

                            if (result.length > 0) {
                                result.forEach((pokemon) => {
                                    var name = db.pokemon.find((x) => x.number == pokemon).name;
                                    var row = $(`<div id="${pokemon}" class="row g-0"></div>`);
                                    var img = $(`<div class="col-md-1"><img src="img/${pokemon}.png" class="img-fluid"></div>`);
                                    var cardbody = $(`<div class="col-md-2"><div class="card-body"><p class=" h4card-title">${name}</p></div></div>`);
                                    var controls = $('<div class="col-md-9"><div class="card-body"><div class="btn-group-vertical"></div></div></div>');
                                    controls.append($('<button type="button" class="btn btn-danger">remove</button>'));
                                    row.append(img);
                                    row.append(cardbody);
                                    row.append(controls);
                                    body.append(row)
                                });
                            } else {
                                body.append('<p class="card-title">No needed Pokemon</p>');
                            }
                            
                            var regionCard = $(`<div class="card my-2"></div>`);
                            regionCard.append(header);
                            regionCard.append(body);

                            $("#list").append(regionCard);
                    })
                    }
                });
                
            }

        </script>
    </body>
</html>
